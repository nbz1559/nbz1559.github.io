<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SaturnV</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="website.ico">
</head>
<body>
<div class="container">
    <aside class="sidebar">
        <h2>SaturnV</h2>
        <nav>
            <ul>
                <li><a href="index.html">Main</a></li>
                <li><a href="tos.html">Terms of Service</a></li>
                <li><a href="#" id="siderbardownload">Download</a></li>
                <li><a href="#" id="sidebardiscord">Discord (Support)</a></li>
                <li><a href="info.html">Other</a></li>
            </ul>
        </nav>
    </aside>

    <main class="main-content">
        <h2>Main</h2>
        <div class="card-container">
            <div class="card">
                <h3 id="statusinfo">Online</h3>
                <p>Status</p>
            </div>
            <div class="card">
                <h3 id="versioninfo">11.4.4</h3>
                <p>Version</p>
            </div>
        </div>

        <div class="columns">
            <div class="column card" id="changelog-column">
                <h3>Changelog</h3>
                <div class="card-content">
                    <div class="sub-card">Loading...</div>
                </div>
            </div>
            <div class="column card" id="announcements-column">
                <h3>Announcements</h3>
                <div class="card-content">
                    <div class="sub-card">Loading...</div>
                </div>
            </div>
        </div>
    </main>
</div>

<script>
    document.getElementById("siderbardownload").addEventListener("click", async function() {
        const btn = this;
        const originalText = btn.textContent;
        btn.disabled = true;

        try {
            const response = await fetch("https://api.github.com/repos/nbz1559/SaturnV/releases/latest");
            if (!response.ok) throw new Error("Network error");

            const data = await response.json();
            let downloadUrl = "#";
            if (Array.isArray(data.assets) && data.assets.length > 0) {
                downloadUrl = data.assets[0].browser_download_url;
            } else {
                throw new Error("No assets found");
            }
            window.location.href = downloadUrl;
        } catch (err) {
            console.error(err);
            btn.textContent = "Failed to fetch release. Try again.";
            setTimeout(() => {
                btn.textContent = originalText;
            }, 3000);
        } finally {
            btn.disabled = false;
        }
    });

    document.getElementById("sidebardiscord").addEventListener("click", async function(e) {
        e.preventDefault();
        const btn = this;
        btn.disabled = true;

        try {
            const response = await fetch("https://api.saturnvmenu.com/discordinvite");
            if (!response.ok) throw new Error(`Network error: ${response.status}`);

            const data = await response.json();
            if (data.success && data.message) {
                window.open(data.message, "_blank");
            } else {
                throw new Error("Invalid server response");
            }
        } catch (err) {
            console.error(err);
            alert("Failed to fetch Discord invite. Try again.");
        } finally {
            btn.disabled = false;
        }
    });

    function updateColumn(columnId, staticData, includeSecondline) {
    const column = document.getElementById(columnId);
    const content = column.querySelector('.card-content');
    content.innerHTML = '<div class="sub-card">Loading...</div>';

    try {
        if (Array.isArray(staticData) && staticData.length > 0) {
            content.innerHTML = '';

            staticData.forEach(groupStr => {
                groupStr = groupStr.replace(/^\{|\}$/g, '');
                const lines = groupStr.split(',');

                const groupDiv = document.createElement('div');
                groupDiv.className = 'sub-card';

                lines.forEach((line, index) => {
                    const p = document.createElement('p');
                    p.textContent = line.trim();

                    if (index === 0 && includeSecondline)  {
                        p.classList.add("first-line");
                    }
                    else if (index === 0) p.classList.add("second-line");
                    if (index === 1 && includeSecondline) p.classList.add("second-line");

                    groupDiv.appendChild(p);
                });

                content.appendChild(groupDiv);
            });
        } else {
            content.innerHTML = `<div class="sub-card">${emptyMessage}</div>`;
        }
    } catch (err) {
        console.error(err);
        content.innerHTML = `<div class="sub-card">Failed to render data.</div>`;
    }
}

    async function update_changelogs() {
        const response = await fetch("https://api.saturnvmenu.com/changelog");
            if (!response.ok) throw new Error(`Network error: ${response.status}`);
            try {
            const data = await response.json();
            if (data.success) {
                updateColumn('changelog-column', data.changelog, true);
            }
        } catch (err) {
            console.error(err);
        }
    }

    async function update_announcements() {
        const response = await fetch("https://api.saturnvmenu.com/announcements");
            if (!response.ok) throw new Error(`Network error: ${response.status}`);
            try {
            const data = await response.json();
            if (data.success) {
                updateColumn('announcements-column', data.ANNOUNCEMENTS, false);
            }
        } catch (err) {
            console.error(err);
        }
    }

    async function update_version() {
        const response = await fetch("https://api.saturnvmenu.com/version");
            if (!response.ok) throw new Error(`Network error: ${response.status}`);
            try {
            const data = await response.json();
            if (data.success) {
                document.getElementById("versioninfo").textContent = data.version;
            }
        } catch (err) {
            console.error(err);
        }
    }

    async function update_status() {
        const response = await fetch("https://api.saturnvmenu.com/status");
            if (!response.ok) throw new Error(`Network error: ${response.status}`);
            try {
            const data = await response.json();
            if (data.success) {
                document.getElementById("statusinfo").textContent = data.status;
            }
        } catch (err) {
            console.error(err);
        }
    }

    update_changelogs();
    update_announcements();
    update_version();
    update_status();
</script>
</body>
<footer class="footer-bar">
    &copy; 2026 SaturnV Menu. All rights reserved.
</footer>
</html>